YUI.add("hermes-template-photo-page-lightbox",(function(e,t){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,a,l,r){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression((n(a,"outlet")||t&&n(t,"outlet")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?n(t,"photo-well-view"):t,{name:"outlet",hash:{},data:r,loc:{start:{line:1,column:0},end:{line:1,column:26}}}))+"\n"},useData:!0}),l={};e.Array.each([],(function(t){var a=e.Template.get("hermes/"+t);a&&(l[t]=a)})),e.Template.register("hermes/photo-page-lightbox",(function(t,r){return(r=r||{}).partials=r.partials?e.merge(l,r.partials):l,a(t,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-card-engagement",(function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,l,a){return" theme-overlay"},3:function(n,e,t,l,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t"+n.escapeExpression((o(t,"outlet")||e&&o(e,"outlet")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},null!=e?o(e,"like-engagement-item-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:5,column:2},end:{line:5,column:38}}}))+"\n"},5:function(n,e,t,l,a){var o,r=null!=e?e:n.nullContext||{},u=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<span role="button" class="engagement-item fave '+(null!=(o=u(t,"if").call(r,null!=(o=null!=(o=null!=e?u(e,"photoItem"):e)?u(o,"engagement"):o)?u(o,"isFaved"):o,{name:"if",hash:{},fn:n.program(6,a,0),inverse:n.noop,data:a,loc:{start:{line:7,column:50},end:{line:7,column:99}}}))?o:"")+(null!=(o=u(t,"if").call(r,null!=(o=null!=(o=null!=e?u(e,"photoItem"):e)?u(o,"engagement"):o)?u(o,"canFave"):o,{name:"if",hash:{},fn:n.noop,inverse:n.program(8,a,0),data:a,loc:{start:{line:7,column:99},end:{line:7,column:155}}}))?o:"")+'" tabindex="0">\n\t\t\t<span class="engagement-icon">\n\t\t\t\t<i class="animated-fave-star"></i>\n\t\t\t</span>\n\t\t\t<span class="engagement-count'+(null!=(o=u(t,"if").call(r,null!=(o=null!=(o=null!=e?u(e,"photoItem"):e)?u(o,"engagement"):o)?u(o,"faveCount"):o,{name:"if",hash:{},fn:n.noop,inverse:n.program(10,a,0),data:a,loc:{start:{line:11,column:32},end:{line:11,column:83}}}))?o:"")+'">\n\t\t\t\t'+(null!=(o=u(t,"if").call(r,null!=(o=null!=(o=null!=e?u(e,"photoItem"):e)?u(o,"engagement"):o)?u(o,"faveCount"):o,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:12,column:4},end:{line:12,column:96}}}))?o:"")+"\n\t\t\t</span>\n\t\t</span>\n"},6:function(n,e,t,l,a){return" faved"},8:function(n,e,t,l,a){return" can-not-fave"},10:function(n,e,t,l,a){return" empty"},12:function(n,e,t,l,a){var o,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return n.escapeExpression((r(t,"formatNumber")||e&&r(e,"formatNumber")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},null!=(o=null!=(o=null!=e?r(e,"photoItem"):e)?r(o,"engagement"):o)?r(o,"faveCount"):o,{name:"formatNumber",hash:{},data:a,loc:{start:{line:12,column:42},end:{line:12,column:89}}}))},14:function(n,e,t,l,a){var o,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return n.escapeExpression((r(t,"formatNumber")||e&&r(e,"formatNumber")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},null!=(o=null!=(o=null!=e?r(e,"photoItem"):e)?r(o,"engagement"):o)?r(o,"commentCount"):o,{name:"formatNumber",hash:{},data:a,loc:{start:{line:22,column:44},end:{line:22,column:94}}}))},16:function(n,e,t,l,a){return'\t\t<span role="button" class="engagement-item curate" tabindex="0">\n\t\t\t<span class="engagement-icon">\n\t\t\t\t<svg class="icon icon-curate"><use xlink:href="#icon-curate"></use></svg>\n\t\t\t</span>\n\t\t</span>\n'},18:function(n,e,t,l,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t"+n.escapeExpression((o(t,"outlet")||e&&o(e,"outlet")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},null!=e?o(e,"fluid-share-photo-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:33,column:2},end:{line:33,column:35}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(n,e,t,l,a){var o,r=null!=e?e:n.nullContext||{},u=n.hooks.helperMissing,i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<div class="photo-card-engagement\n\t'+(null!=(o=(i(t,"ifCond")||e&&i(e,"ifCond")||u).call(r,null!=e?i(e,"theme"):e,"===","overlay",{name:"ifCond",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:1},end:{line:2,column:59}}}))?o:"")+'">\n\n'+(null!=(o=(i(t,"isFlipped")||e&&i(e,"isFlipped")||u).call(r,"enable-likes",{name:"isFlipped",hash:{},fn:n.program(3,a,0),inverse:n.program(5,a,0),data:a,loc:{start:{line:4,column:1},end:{line:15,column:15}}}))?o:"")+'\t\n\t<span role="button" class="engagement-item comment" tabindex="0">\n\t\t<span class="engagement-icon">\n\t\t\t<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n\t\t</span>\n\t\t<span class="engagement-count'+(null!=(o=i(t,"if").call(r,null!=(o=null!=(o=null!=e?i(e,"photoItem"):e)?i(o,"engagement"):o)?i(o,"commentCount"):o,{name:"if",hash:{},fn:n.noop,inverse:n.program(10,a,0),data:a,loc:{start:{line:21,column:31},end:{line:21,column:85}}}))?o:"")+'">\n\t\t\t'+(null!=(o=i(t,"if").call(r,null!=(o=null!=(o=null!=e?i(e,"photoItem"):e)?i(o,"engagement"):o)?i(o,"commentCount"):o,{name:"if",hash:{},fn:n.program(14,a,0),inverse:n.noop,data:a,loc:{start:{line:22,column:3},end:{line:22,column:101}}}))?o:"")+"\n\t\t</span>\n\t</span>\n"+(null!=(o=i(t,"if").call(r,null!=e?i(e,"displayCurate"):e,{name:"if",hash:{},fn:n.program(16,a,0),inverse:n.noop,data:a,loc:{start:{line:25,column:1},end:{line:31,column:8}}}))?o:"")+(null!=(o=i(t,"if").call(r,null!=e?i(e,"displayShare"):e,{name:"if",hash:{},fn:n.program(18,a,0),inverse:n.noop,data:a,loc:{start:{line:32,column:1},end:{line:34,column:8}}}))?o:"")+"</div>\n"},useData:!0}),l={};n.Array.each([],(function(e){var t=n.Template.get("hermes/"+e);t&&(l[e]=t)})),n.Template.register("hermes/photo-card-engagement",(function(e,a){return(a=a||{}).partials=a.partials?n.merge(l,a.partials):l,t(e,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-card-engagement-view",(function(e,t){var n=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("photo-card-engagement-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.set("isActiveViewAgnostic",!0),this.signedIn=this.appContext.getViewer().signedIn,this.params=t,this.config={displayCurate:!("displayCurate"in t)||t.displayCurate,displayShare:"displayShare"in t&&t.displayShare,photoItem:t.photoItem,theme:t.theme,enableFaveKey:t.enableFaveKey},this.config.displayCurate=this.config.displayCurate&&this.signedIn,t.subviewParams={"like-engagement-item-view":{photoId:t.photoItem.photoId,showCount:!0,size:"small",isPadded:!1,theme:"overlay"===this.config.theme?"light":void 0},"fluid-share-photo-view":{photoId:t.photoItem.photoId,nsid:t.photoItem.owner.nsid,size:"small",theme:"light"}},this.curationHelper=new e.CurationHelper(this.appContext,{view:this})},subviewConfig:{"like-engagement-item-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["engagement-item","like"],disabled:function(){return!this.appContext.flipper.isFlipped("enable-likes")}},"fluid-share-photo-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["engagement-item","share"]}},buildContainer:function(){this.setContainerWithTemplate("photo-card-engagement",this.config)},activate:function(){var e=this.get("container");this.faveNode=e.one(".engagement-item.fave"),this.commentNode=e.one(".engagement-item.comment"),this.curateNode=e.one(".engagement-item.curate"),this.faveNode&&(this.faveCountNode=this.faveNode.one(".engagement-count"),this.registerEventHandler(this.faveNode.on(["click","key"],this.handleFaveClick.bind(this),"down:13")),this.config.enableFaveKey&&(this.keyEventHandler=this.attachKeyEvent("down:70",this.handleFaveKeyPress.bind(this)))),this.commentNode&&(this.commentIcon=this.commentNode.one(".engagement-icon"),this.commentCountNode=this.commentNode.one(".engagement-count"),this.registerEventHandler(this.commentNode.on(["click","key"],this.handleCommentClick.bind(this),"down:13"))),this.curateNode&&this.registerEventHandler(this.curateNode.on(["click","key"],this.handleCurateClick.bind(this),"down:13")),this.commentCountNode&&this.config.photoItem.engagementModel.on("valuesChanged",(e=>{if(e.commentCount){var t=e.commentCount.newVal;this.commentCountNode.set("text",e.commentCount.newVal),this.commentCountNode.toggleClass("empty",0===t)}}))},handleFaveKeyPress:function(e){70===e.keyCode&&this.handleFaveClick(e)},handleFaveClick:function(t){var i,o=this,s=this.faveNode,a=this.faveCountNode;this.faveNode.hasClass("can-not-fave")||(this.signedIn?this.isFaving||(this.isFaving=!0,this.config.photoItem.engagementModel.toggleFave(),i=this.config.photoItem.engagementModel.getValue("faveCount"),s.toggleClass("faved",this.config.photoItem.engagementModel.getValue("isFaved")),a.toggleClass("empty",0===i),a&&i>0?a.set("text",i):a.set("text",""),this.config.photoItem.engagementModel.remoteUpdate().then((function(){o.isFaving=!1}),(function(e){3!==e.code&&(o.config.photoItem.engagementModel.toggleFave(),s.toggleClass("faved",o.config.photoItem.engagementModel.getValue("isFaved")),a&&(a.set("text",i),a.toggleClass("empty",0===i))),n.error("Error faving photo",{err:e}),o.isFaving=!1}))):this.showSignUpAndFaveModal(this.config.photoItem.photoId,e.config.win.location.href))},handleCommentClick:function(){var t=this,n={appContext:this.appContext,photoId:this.config.photoItem.photoId,isScrollable:!0},i=this.config.photoItem.engagementModel.getValue("commentCount");if(this.signedIn||0!==i){var o=new e.ModalDroparoundHelper(this.appContext,{configs:{common:{subviewName:"photo-comments-view"},droparound:{subviewParams:n,preferTop:!0,width:400,height:400,anchorElement:this.commentIcon,keyboardAnchorElement:this.commentNode},modal:{subviewParams:Object.assign({},n,{hasHeader:!0}),height:550,flexLayout:!0}}});o.show(),t.registerEventHandler(e.on("addComment:showingSignupModal",(function(){o.close()}))),t.registerEventHandler(o.on("close",(function(){t.commentNode.removeClass("active"),t.fire("menuClosed")}))),this.commentNode.addClass("active"),this.fire("menuOpened")}else this.showSignUpAndCommentModal()},handleCurateClick:function(){var e=this,t=this.config.photoItem.isOwner;"fluid-droparound-view"===this.curationHelper.showAddToCuration({photoId:this.config.photoItem.photoId,showAlbums:t,showGalleries:!t,anchorNode:this.curateNode}).name&&(this.fire("menuOpened"),this.curationHelper.on("curateDroparoundClosed",(function(){e.fire("menuClosed"),e.curateNode.removeClass("active")})),this.curateNode.addClass("active"))},showSignUpAndFaveModal:function(t,n){var i,o=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),s=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"});i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:o,signUpMessage:s,beaconPrefix:"fave"}),this.registerEventHandler(i.on("signUpClick",(function(i){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:n})}))),this.registerEventHandler(i.on("signInClick",(function(i){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:n})}))),i.show()},showSignUpAndCommentModal:function(){var t,n=e.config.win.location.href,i=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_TITLE"}),o=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_MESSAGE"});(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-upload",signUpTitle:i,signUpMessage:o,beaconPrefix:"addComment"})).on("signUpClick",(()=>{e.SigninHelper._redirectToSignUp("",{postLoginUrl:n})})),t.on("signInClick",(()=>{e.SigninHelper._redirectToSignin("",{postLoginUrl:n})})),t.show()},toggleCommentNode:function(e){this.commentNode&&this.commentNode.toggleClass("hidden",!e)},toggleFaveNode:function(e){this.faveNode&&this.faveNode.toggleClass("hidden",!e)}})}),"@VERSION@",{requires:["flickr-view","photo-comments-view","fluid-share-photo-view","hermes-template-photo-card-engagement","curation-helper","modal-droparound-helper"],optionalRequires:["hermes-core"],langBundles:["common","comments","fave-view","photo-page-scrappy"]});YUI.add("hermes-template-photo-card-header",(function(n,t){var l=n.Template.Handlebars.revive({1:function(n,t,l,e,o){return" compact"},3:function(n,t,l,e,o){return" theme-overlay"},5:function(n,t,l,e,o){var a,r,i=null!=t?t:n.nullContext||{},u=n.hooks.helperMissing,s="function",c=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<a\n\t\t\t\tclass="avatar no-refresh\n\t\t\t\t\t'+(null!=(a=p(l,"if").call(i,null!=t?p(t,"isCompact"):t,{name:"if",hash:{},fn:n.program(6,o,0),inverse:n.program(8,o,0),data:o,loc:{start:{line:8,column:5},end:{line:8,column:52}}}))?a:"")+"\n\t\t\t\t\t"+(null!=(a=p(l,"if").call(i,null!=t?p(t,"isPersonAttribution"):t,{name:"if",hash:{},fn:n.program(10,o,0),inverse:n.noop,data:o,loc:{start:{line:9,column:5},end:{line:9,column:46}}}))?a:"")+"\n\t\t\t\t\t"+(null!=(a=p(l,"if").call(i,null!=t?p(t,"isGroupAttribution"):t,{name:"if",hash:{},fn:n.program(12,o,0),inverse:n.noop,data:o,loc:{start:{line:10,column:5},end:{line:10,column:44}}}))?a:"")+'"\n\t\t\t\tstyle="background-image: url('+c(typeof(r=null!=(r=p(l,"iconUrl")||(null!=t?p(t,"iconUrl"):t))?r:u)===s?r.call(i,{name:"iconUrl",hash:{},data:o,loc:{start:{line:11,column:33},end:{line:11,column:44}}}):r)+');"\n\t\t\t\thref="'+c(typeof(r=null!=(r=p(l,"url")||(null!=t?p(t,"url"):t))?r:u)===s?r.call(i,{name:"url",hash:{},data:o,loc:{start:{line:12,column:10},end:{line:12,column:17}}}):r)+'"\n\t\t\t\t'+(null!=(a=p(l,"if").call(i,null!=t?p(t,"isPersonAttribution"):t,{name:"if",hash:{},fn:n.program(14,o,0),inverse:n.noop,data:o,loc:{start:{line:13,column:4},end:{line:13,column:74}}}))?a:"")+"\n\t\t\t\t"+(null!=(a=p(l,"if").call(i,null!=t?p(t,"isGroupAttribution"):t,{name:"if",hash:{},fn:n.program(16,o,0),inverse:n.noop,data:o,loc:{start:{line:14,column:4},end:{line:14,column:72}}}))?a:"")+"></a>\n"},6:function(n,t,l,e,o){return" very-tiny"},8:function(n,t,l,e,o){return" tiny"},10:function(n,t,l,e,o){return" person"},12:function(n,t,l,e,o){return" group"},14:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'data-person-nsid="'+n.escapeExpression("function"==typeof(a=null!=(a=r(l,"attributionId")||(null!=t?r(t,"attributionId"):t))?a:n.hooks.helperMissing)?a.call(null!=t?t:n.nullContext||{},{name:"attributionId",hash:{},data:o,loc:{start:{line:13,column:49},end:{line:13,column:66}}}):a)+'"'},16:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'data-group-nsid="'+n.escapeExpression("function"==typeof(a=null!=(a=r(l,"attributionId")||(null!=t?r(t,"attributionId"):t))?a:n.hooks.helperMissing)?a.call(null!=t?t:n.nullContext||{},{name:"attributionId",hash:{},data:o,loc:{start:{line:14,column:47},end:{line:14,column:64}}}):a)+'"'},18:function(n,t,l,e,o){var a,r,i=null!=t?t:n.nullContext||{},u=n.hooks.helperMissing,s="function",c=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<div class="title-container">\n\t\t\t\t\t<a class="title" href="'+c(typeof(r=null!=(r=p(l,"url")||(null!=t?p(t,"url"):t))?r:u)===s?r.call(i,{name:"url",hash:{},data:o,loc:{start:{line:19,column:28},end:{line:19,column:35}}}):r)+'">'+c(typeof(r=null!=(r=p(l,"title")||(null!=t?p(t,"title"):t))?r:u)===s?r.call(i,{name:"title",hash:{},data:o,loc:{start:{line:19,column:37},end:{line:19,column:46}}}):r)+"</a>\n"+(null!=(a=p(l,"if").call(i,null!=t?p(t,"showProBadge"):t,{name:"if",hash:{},fn:n.program(19,o,0),inverse:n.noop,data:o,loc:{start:{line:20,column:5},end:{line:26,column:12}}}))?a:"")+"\t\t\t\t</div>\n"},19:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=(r(l,"ifCond")||t&&r(t,"ifCond")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=t?r(t,"theme"):t,"===","overlay",{name:"ifCond",hash:{},fn:n.program(20,o,0),inverse:n.program(22,o,0),data:o,loc:{start:{line:21,column:6},end:{line:25,column:17}}}))?a:""},20:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=n.invokePartial(r(e,"pro-badge"),t,{name:"pro-badge",hash:{purchaseProURL:null!=t?r(t,"purchaseProURL"):t,light:!0,badgeType:null!=t?r(t,"proBadgeType"):t},data:o,indent:"\t\t\t\t\t\t\t",helpers:l,partials:e,decorators:n.decorators}))?a:""},22:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=n.invokePartial(r(e,"pro-badge"),t,{name:"pro-badge",hash:{purchaseProURL:null!=t?r(t,"purchaseProURL"):t,badgeType:null!=t?r(t,"proBadgeType"):t},data:o,indent:"\t\t\t\t\t\t\t",helpers:l,partials:e,decorators:n.decorators}))?a:""},24:function(n,t,l,e,o){var a,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<div class="card-details">\n'+(null!=(a=i(l,"if").call(r,null!=t?i(t,"activityName"):t,{name:"if",hash:{},fn:n.program(25,o,0),inverse:n.noop,data:o,loc:{start:{line:32,column:5},end:{line:35,column:12}}}))?a:"")+'\t\t\t\t\t<span class="time">\n\t\t\t\t\t\t'+(null!=(a=(i(l,"friendlySinceDate")||t&&i(t,"friendlySinceDate")||n.hooks.helperMissing).call(r,null!=t?i(t,"time"):t,!0,!0,{name:"friendlySinceDate",hash:{},fn:n.program(27,o,0),inverse:n.noop,data:o,loc:{start:{line:37,column:6},end:{line:37,column:108}}}))?a:"")+"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n"},25:function(n,t,l,e,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<span class="activity-type">'+n.escapeExpression("function"==typeof(a=null!=(a=r(l,"activityName")||(null!=t?r(t,"activityName"):t))?a:n.hooks.helperMissing)?a.call(null!=t?t:n.nullContext||{},{name:"activityName",hash:{},data:o,loc:{start:{line:33,column:34},end:{line:33,column:50}}}):a)+'</span>\n\t\t\t\t\t\t<span class="separator">&middot;</span>\n'},27:function(n,t,l,e,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression((a(l,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{time:null!=t?a(t,"time"):t,intlName:null!=t?a(t,"intlName"):t},data:o,loc:{start:{line:37,column:43},end:{line:37,column:86}}}))},29:function(n,t,l,e,o){return'\t\t\t<div role="button" class="menu-button">\n\t\t\t\t<svg class="icon icon-more_horizontal"><use xlink:href="#icon-more_horizontal"></use></svg>\n\t\t\t</div>\n'},compiler:[8,">= 4.3.0"],main:function(n,t,l,e,o){var a,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="photo-card-header\n\t'+(null!=(a=i(l,"if").call(r,null!=t?i(t,"isCompact"):t,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.noop,data:o,loc:{start:{line:2,column:1},end:{line:2,column:33}}}))?a:"")+"\n\t"+(null!=(a=(i(l,"ifCond")||t&&i(t,"ifCond")||n.hooks.helperMissing).call(r,null!=t?i(t,"theme"):t,"===","overlay",{name:"ifCond",hash:{},fn:n.program(3,o,0),inverse:n.noop,data:o,loc:{start:{line:3,column:1},end:{line:3,column:59}}}))?a:"")+'">\n\t<div class="left-container">\n'+(null!=(a=i(l,"if").call(r,null!=t?i(t,"iconUrl"):t,{name:"if",hash:{},fn:n.program(5,o,0),inverse:n.noop,data:o,loc:{start:{line:5,column:2},end:{line:15,column:9}}}))?a:"")+'\t\t<div class="attribution">\n'+(null!=(a=i(l,"if").call(r,null!=t?i(t,"title"):t,{name:"if",hash:{},fn:n.program(18,o,0),inverse:n.noop,data:o,loc:{start:{line:17,column:3},end:{line:28,column:10}}}))?a:"")+"\n"+(null!=(a=i(l,"if").call(r,null!=t?i(t,"showDetails"):t,{name:"if",hash:{},fn:n.program(24,o,0),inverse:n.noop,data:o,loc:{start:{line:30,column:3},end:{line:40,column:10}}}))?a:"")+'\t\t</div>\n\t</div>\n\t<div class="right-container">\n'+(null!=(a=i(l,"if").call(r,null!=t?i(t,"showMenu"):t,{name:"if",hash:{},fn:n.program(29,o,0),inverse:n.noop,data:o,loc:{start:{line:44,column:2},end:{line:48,column:9}}}))?a:"")+"\t</div>\n</div>\n"},usePartial:!0,useData:!0}),e={};n.Array.each(["pro-badge","pro-badge"],(function(t){var l=n.Template.get("hermes/"+t);l&&(e[t]=l)})),n.Template.register("hermes/photo-card-header",(function(t,o){return(o=o||{}).partials=o.partials?n.merge(e,o.partials):e,l(t,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge","hermes-template-pro-badge"]});YUI.add("fluid-share-group-view",(function(e,t){var r=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){return this.groupId=e.groupId,this.selectedSubnav=e.subnavConfig?e.subnavConfig.selected:void 0,this.showShareButtonLabel=void 0===e.showShareButtonLabel||e.showShareButtonLabel,this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-group-icon",showShareButtonLabel:this.showShareButtonLabel,sharingDisabled:!1,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_GROUP"})})},loadState:function(){return this.isEnglishLang?e.Promise.resolve():this.loadRequiredModels()},getItemCount:function(){return this.isEnglishLang?this.loadRequiredModels():e.Promise.resolve(1)},loadRequiredModels:function(){var t,o,i=this;return i.appContext.getModel("group-pool-models",i.groupId).then((function(r){return this.appContext.getModel("group-models",i.groupId).then((function(a){if(i.set("groupModel",a),t=e.URLHelper.generateGroupUrls(a),o="overview"===i.selectedSubnav?t.about:"pool"===i.selectedSubnav?t.photos:t[i.selectedSubnav]?t[i.selectedSubnav]:t.about,i.set("groupFullPath",o),r){if(i.isDisabled=1===r.getValue("group").getValue("privacy")||2===r.getValue("group").getValue("privacy"),i.isDisabled){var s=e.URLHelper.generateGroupUrls(a).invite;i.errorTitle=i.intlMessage({intlName:"share-modal.CANT_SHARE_PRIVATE_GROUP_TITLE"}),i.errorMessage=i.intlMessage({intlName:"share-modal.CANT_SHARE_PRIVATE_GROUP_MESSAGE",inviteURL:s})}return r.getValue("photoPageList").getPage({perPage:5}).then((function(e){i.set("photos",e)}))}i.isDisabled=!0}),(function(e){throw e}))}),(function(e){if(2!==e.code&&4!==e.code)throw e;r.warn("Error loading pool model",{err:e}),i.isDisabled=!0}))},buildContainer:function(){return this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-group-icon",showShareButtonLabel:this.showShareButtonLabel,sharingDisabled:this.isDisabled,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_GROUP"})}),this},prepareFacebookShareParameters:function(){return{url:this.get("groupFullPath")}},prepareTwitterShareParameters:function(){var t=this.get("groupModel");return{url:e.URLHelper.getShortGroupURL(t.getValue("id"),this.selectedSubnav),title:t.getValue("title")}},prepareTumblrShareParameters:function(){var e=this.get("groupModel");return{title:e.getValue("title"),description:e.getValue("description"),displayPhotoURL:this.get("photos").map((function(e){return e.getLargestSize().url})),url:this.get("groupFullPath"),tags:"Flickr"}},preparePinterestShareParameters:function(){var t=this.get("groupModel");return{title:t.getValue("title"),description:t.getValue("description"),displayPhotoURL:this.get("photos").length>0?this.get("photos")[0].getLargestSize().url:null,shortURL:e.URLHelper.getShortGroupURL(t.getValue("id"),this.selectedSubnav),url:this.get("groupFullPath"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("groupModel");return{title:e.getValue("title"),modelName:"group",modelId:e.getValue("id"),url:this.get("groupFullPath"),count:1}},prepareLinkShareParameters:function(){var t=this.get("groupModel"),r=this.get("photos");return{url:t.getValue("url"),shortURL:e.URLHelper.getShortGroupURL(t.getValue("id"),this.selectedSubnav),supportsEmbedr:t.getValue("showPoolToNonMembers")&&!t.getValue("eighteenplus"),embedUrl:"/groups/"+t.getValue("id")+"/pool/",sizes:r.length>0?e.EmbedSizeHelper.getSizes(r[0]):void 0,title:t.getValue("title"),groupId:t.getValue("id")}},getTitleIntlKey:function(){return"SHARE_GROUP_TO"},getGuestPassParams:function(){return{contentMarkedFriends:!1,contentMarkedFamily:!1,contentMarkedPublic:!0,contentMarkedFriendFamily:!1,canSharePrivate:!1,showGuestPassDropdown:!1,multipleItems:!0}}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper","embed-size-helper"],optionalRequires:["hermes-core"],langBundles:["models","default"]});YUI.add("photo-card-header-helper",(function(e,t){var n=require("hermes-core/flog")(t),o=e.mix({langBundles:["common","feed","feed-new","profile","photo-card","header"]},e.Localizable);e.PhotoCardHeaderHelper=function(t,a){var i,r,s=a.menuConfig,l=a.view,c={isFaded:s?s.isFaded:void 0,load:function(){var t=this;return s&&this.loadContextMenuData().then((function(){t.isContextMenuReady=!0})),e.Promise.resolve()},loadContextMenuData:function(){var n;switch(s.type){case"Person":case"PersonBatch":n=t.getModel("person-relationship-models",s.owner.nsid).then((function(e){return r=e,e}));break;case"Group":n=(i=new e.GroupStatusHelper(t,{groupId:s.groupId,viewParams:a.viewParams,view:l})).load();break;default:n=e.Promise.resolve()}return n},getContextMenuConfig:function(){var n,a=this,c={actionList:[]};switch(s.type){case"Person":c.actionList.push({actionId:"sharePhoto",text:o.intlMessage({intlName:"photo-card.SHARE_THIS_PHOTO"}),onSelected:function(n){var o;s.photoId&&s.owner.nsid&&(o=new e.Views["fluid-share-photo-view"]({appContext:t,photoId:s.photoId,nsid:s.owner.nsid}),l.registerEventHandler(o.on("sharePresentationClose",o.destroy.bind(o))),o.initialize().then((function(){o.prepareModal()})))}}),c.actionList.push({actionId:"sendMessage",text:o.intlMessage({intlName:"photo-card.SEND_A_MESSAGE"}),onSelected:function(n){var o=e.config.win.open("about:blank","_blank");t.getModel("person-models",s.owner.nsid).then((function(t){o.location.replace(e.URLHelper.generatePersonUrls(t).sendFlickrMail)}))}}),r.getValue("isIgnored")||(r.getValue("isContact")?c.actionList.push({actionId:"unfollowOwner",text:o.intlHTMLMessage({intlName:"photo-card.UNFOLLOW_USER",username:s.owner.displayname}),onSelected:function(e){a.toggleFollowPerson(!1)}}):c.actionList.push({actionId:"followOwner",text:o.intlHTMLMessage({intlName:"photo-card.FOLLOW_USER",username:s.owner.displayname}),onSelected:function(e){a.toggleFollowPerson(!0)}})),r.getValue("isIgnored")?c.actionList.push({actionId:"unblockOwner",text:o.intlHTMLMessage({intlName:"photo-card.UNBLOCK_USER",username:s.owner.displayname}),onSelected:function(e){a.toggleBlockPerson(!1)}}):c.actionList.push({actionId:"blockOwner",text:o.intlHTMLMessage({intlName:"photo-card.BLOCK_USER",username:s.owner.displayname}),onSelected:function(e){a.showBlockConfirmCta(s.owner.displayname)}});break;case"PersonBatch":c.actionList.push({actionId:"sharePhotostream",text:o.intlMessage({intlName:"photo-card.SHARE_PHOTOSTREAM"}),onSelected:function(n){var o;s.owner.nsid&&(o=new e.Views["fluid-share-photostream-view"]({appContext:t,nsid:s.owner.nsid}),l.registerEventHandler(o.on("sharePresentationClose",o.destroy.bind(o))),o.initialize().then((function(){o.prepareModal()})))}}),c.actionList.push({actionId:"sendMessage",text:o.intlMessage({intlName:"photo-card.SEND_A_MESSAGE"}),onSelected:function(n){var o=e.config.win.open("about:blank","_blank");t.getModel("person-models",s.owner.nsid).then((function(t){o.location.replace(e.URLHelper.generatePersonUrls(t).sendFlickrMail)}))}}),r.getValue("isIgnored")||(r.getValue("isContact")?c.actionList.push({actionId:"unfollowOwner",text:o.intlHTMLMessage({intlName:"photo-card.UNFOLLOW_USER",username:s.owner.displayname}),onSelected:function(e){a.toggleFollowPerson(!1)}}):c.actionList.push({actionId:"followOwner",text:o.intlHTMLMessage({intlName:"photo-card.FOLLOW_USER",username:s.owner.displayname}),onSelected:function(e){a.toggleFollowPerson(!0)}})),r.getValue("isIgnored")?c.actionList.push({actionId:"unblockOwner",text:o.intlHTMLMessage({intlName:"photo-card.UNBLOCK_USER",username:s.owner.displayname}),onSelected:function(e){a.toggleBlockPerson(!1)}}):c.actionList.push({actionId:"blockOwner",text:o.intlHTMLMessage({intlName:"photo-card.BLOCK_USER",username:s.owner.displayname}),onSelected:function(e){a.showBlockConfirmCta(s.owner.displayname)}});break;case"Group":(n=i.getInfo()).joinStatus.canJoin||(a.isFaded?c.actionList.push({actionId:"unmuteGroup",text:o.intlMessage({intlName:"photo-card.SHOW_IN_ACTIVITY_FEED"}),onSelected:function(e){s.groupId&&(i.toggleMuteGroup(!1),a.isFaded=!1)}}):c.actionList.push({actionId:"muteGroup",text:o.intlMessage({intlName:"photo-card.HIDE_FROM_ACTIVITY_FEED"}),onSelected:function(e){s.groupId&&(i.toggleMuteGroup(!0),a.isFaded=!0)}})),c.actionList.push({actionId:"shareGroup",text:o.intlMessage({intlName:"photo-card.SHARE_GROUP"}),onSelected:function(n){var o;s.groupId&&(o=new e.Views["fluid-share-group-view"]({appContext:t,groupId:s.groupId}),l.registerEventHandler(o.on("sharePresentationClose",o.destroy.bind(o))),o.initialize().then((function(){o.prepareModal()})))}}),n.joinStatus.canJoin?c.actionList.push({actionId:"joinGroup",text:o.intlMessage({intlName:"photo-card.JOIN_GROUP"}),onSelected:function(e){if(s.groupId)return i.initiateJoinGroup()}}):n.groupAttrs.isMember&&c.actionList.push({actionId:"leaveGroup",text:o.intlMessage({intlName:"photo-card.LEAVE_GROUP"}),onSelected:function(e){if(s.groupId)return i.initiateLeaveGroup()}})}return c},toggleFollowPerson:function(e){return r.setValue("isContact",e),r.remoteUpdate().catch((function(e){r.setValue("isContact",!1),n.error({err:e})}))},toggleBlockPerson:function(e){return r.setValue("isIgnored",e),e&&r.setValue("isContact",!1),r.remoteUpdate().catch((function(e){r.setValue("isContact",!1),n.error({err:e})}))},showBlockConfirmCta:function(n){var a=this;new e.Views.FluidModal({appContext:t,subview:new e.Views["confirmation-dialog-view"]({appContext:t,title:o.intlHTMLMessage({intlName:"photo-card.BLOCK_USER_QUESTION",username:n}),htmlMessage:"<p>"+o.intlMessage({intlName:"photo-card.BLOCK_CONFIRM_MESSAGE"})+"</p><p>"+o.intlHTMLMessage({intlName:"photo-card.BLOCK_CONFIRM_MESSAGE_NOTE"})+"</p>",confirmButtonIsDangerous:!0,confirmButtonText:o.intlMessage({intlName:"header.BLOCK"}),onConfirm:async(e,t)=>{t.setLoading(!0),await a.toggleBlockPerson(!0)}}),hasSubviewConfigRefactor:!0}).show()},insertUserPrefs:function(e){return t.callAPI("flickr.feed.preferences.insertUserPreferences",e)}};return e.augment(c,e.EventTarget),c}}),"@VERSION@",{requires:["event-custom","storage-helper","photo-card-helper","group-status-helper","url-helper","fluid-share-photo-view","fluid-share-photostream-view","fluid-share-group-view"],optionalRequires:["hermes-core"],langBundles:["common","feed","feed-new","profile","photo-card","header"]});YUI.add("photo-card-header-view",(function(e,t){require("hermes-core/flog")(t);var i=new e.SubscriptionsHelper;e.namespace("Views")[this.name]=e.Base.create("photo-card-header-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.params=t,this.set("isActiveViewAgnostic",!0),this.params.showMenu="showMenu"in this.params&&this.params.showMenu,this.params.showDetails="activityName"in this.params&&"time"in this.params,this.photoCardHeaderHelper=this.params.photoCardHeaderHelper||new e.PhotoCardHeaderHelper(this.appContext,{menuConfig:this.params.menuConfig,viewParams:this.params,view:this}),this.params.purchaseProURL=i.getProLandingPageUrl(i.UTM_PRO_BADGE,{utm_medium:this.name})},loadState:function(){return this.photoCardHeaderHelper.load()},buildContainer:function(){this.setContainerWithTemplate("photo-card-header",this.params)},activate:function(){var e=this.get("container");this.leftContainerNode=e.one(".left-container"),this.rightContainerNode=e.one(".right-container"),this.titleContainerNode=this.leftContainerNode.one(".title-container"),this.avatarNode=this.leftContainerNode.one(".avatar"),this.titleNode=this.titleContainerNode.one(".title"),this.proBadgeNode=this.titleContainerNode.one(".pro-badge-new"),this.params.showMenu&&this.setupContextMenu()},updateBreakpoints:function(){var e;this.toggleAvatar(!0),this.toggleProBadge(!0),this.avatarNode&&(e=this.titleNode.get("clientWidth"))<100&&e<this.titleNode.get("scrollWidth")&&(this.toggleAvatar(!1),this.proBadgeNode&&(e=this.titleNode.get("clientWidth"))<100&&this.titleNode.get("clientWidth")<this.titleNode.get("scrollWidth")&&this.toggleProBadge(!1))},toggleAvatar:function(e){this.avatarNode&&this.avatarNode.toggleClass("hidden",!e)},toggleProBadge:function(e){this.proBadgeNode&&this.proBadgeNode.toggleClass("hidden",!e)},setupContextMenu:function(){var e=this.get("container");this.contextMenuNode=e.one(".menu-button"),this.registerEventHandler(this.contextMenuNode.on("click",this.handleMenuButtonClick.bind(this)))},handleMenuButtonClick:function(){var t,i,n,o=this;this.params.item;this.photoCardHeaderHelper.isContextMenuReady&&(i=(t=this.photoCardHeaderHelper.getContextMenuConfig()).actionList.map((function(e){return{text:e.text,value:e.actionId}})),(n=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorOffsetVertical:0,width:200,dismissOnOverlayClick:!0,anchorElement:this.contextMenuNode,menuItems:i,classList:"photo-card-header-context-menu"})).show(),this.fire("contextMenuOpen"),this.registerEventHandler(n.on("selected",(function(i){var a=t.actionList.find((function(e){return e.actionId===i.menuItem.value}));e.Analytics.sendClick("Context Menu Item: "+a.actionId,"Context Menu Item Click"),n.close(),o.fire("contextMenuItemSelected",{action:a})}))),this.registerEventHandler(n.on("closeDroparound",(()=>{this.fire("contextMenuClosed")}))))},toggleFaded:function(e){this.photoCardHeaderHelper.isFaded=e}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-card-header","photo-card-header-helper","subscriptions-helper"],optionalRequires:["hermes-core"],langBundles:["common","relative-dates"]});